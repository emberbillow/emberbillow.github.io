<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDWæ’å€¼åŠ¨æ€æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }
        
        .control-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            height: fit-content;
        }
        
        .control-section {
            margin-bottom: 25px;
        }
        
        .control-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .control-item {
            margin-bottom: 15px;
        }
        
        .control-item label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-size: 14px;
            font-weight: 500;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: bold;
            margin-left: 8px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .canvas-container {
            position: relative;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        canvas {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
        }
        
        .legend {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #495057;
        }
        
        .legend-gradient {
            height: 30px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .legend-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #6c757d;
        }
        
        .info-box {
            margin-top: 15px;
            padding: 12px;
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            border-radius: 5px;
            font-size: 13px;
            color: #495057;
            line-height: 1.6;
        }
        
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mode-btn {
            padding: 10px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .stats {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            font-size: 13px;
        }
        
        .stats-item {
            margin: 5px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>IDWæ’å€¼æ–¹æ³•åŠ¨æ€æ¼”ç¤ºç³»ç»Ÿ</h1>
        <div class="subtitle">Inverse Distance Weighted Interpolation - æ•™å­¦æ¼”ç¤ºå·¥å…·</div>
        
        <div class="main-content">
            <div class="control-panel">
                <div class="control-section">
                    <h3>ğŸ“ ç‚¹ä½æ¨¡å¼</h3>
                    <div class="mode-selector">
                        <button class="mode-btn active" onclick="setMode('normal')">æ­£å¸¸ç‚¹</button>
                        <button class="mode-btn" onclick="setMode('outlier')">å¼‚å¸¸å€¼</button>
                    </div>
                    <div class="info-box">
                        ç‚¹å‡»ç”»å¸ƒæ·»åŠ é‡‡æ ·ç‚¹ã€‚æ­£å¸¸ç‚¹å€¼åŸŸ0-100ï¼Œå¼‚å¸¸å€¼å¯è¾¾300ã€‚
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>âš™ï¸ IDWå‚æ•°</h3>
                    <div class="control-item">
                        <label>
                            å¹‚æŒ‡æ•° (Power)
                            <span class="value-display" id="powerValue">2.0</span>
                        </label>
                        <input type="range" id="powerSlider" min="0.5" max="5" step="0.1" value="2">
                    </div>
                    
                    <div class="control-item">
                        <label>
                            æœç´¢åŠå¾„
                            <span class="value-display" id="radiusValue">æ— é™åˆ¶</span>
                        </label>
                        <input type="range" id="radiusSlider" min="0" max="300" step="10" value="0">
                    </div>
                    
                    <div class="control-item">
                        <label>
                            åˆ†è¾¨ç‡
                            <span class="value-display" id="resolutionValue">5</span>
                        </label>
                        <input type="range" id="resolutionSlider" min="3" max="15" step="1" value="5">
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>ğŸ² é¢„è®¾åœºæ™¯</h3>
                    <button class="btn-primary" onclick="generateUniform()">å‡åŒ€åˆ†å¸ƒ</button>
                    <button class="btn-primary" onclick="generateClustered()">èšé›†åˆ†å¸ƒ</button>
                    <button class="btn-primary" onclick="generateWithOutliers()">å«å¼‚å¸¸å€¼</button>
                    <button class="btn-danger" onclick="clearPoints()">æ¸…é™¤æ‰€æœ‰ç‚¹</button>
                </div>
                
                <div class="stats" id="stats">
                    <div class="stats-item"><strong>é‡‡æ ·ç‚¹æ•°:</strong> <span id="pointCount">0</span></div>
                    <div class="stats-item"><strong>å¼‚å¸¸å€¼æ•°:</strong> <span id="outlierCount">0</span></div>
                    <div class="stats-item"><strong>æ•°å€¼èŒƒå›´:</strong> <span id="valueRange">-</span></div>
                </div>
            </div>
            
            <div class="canvas-container">
                <canvas id="canvas" width="800" height="600"></canvas>
                
                <div class="legend">
                    <div class="legend-title">æ’å€¼ç»“æœå›¾ä¾‹</div>
                    <div class="legend-gradient" id="legendGradient"></div>
                    <div class="legend-labels">
                        <span id="minLabel">0</span>
                        <span id="midLabel">50</span>
                        <span id="maxLabel">100</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let points = [];
        let currentMode = 'normal';
        let power = 2.0;
        let searchRadius = 0;
        let resolution = 5;
        
        // äº‹ä»¶ç›‘å¬
        document.getElementById('powerSlider').addEventListener('input', (e) => {
            power = parseFloat(e.target.value);
            document.getElementById('powerValue').textContent = power.toFixed(1);
            interpolate();
        });
        
        document.getElementById('radiusSlider').addEventListener('input', (e) => {
            searchRadius = parseFloat(e.target.value);
            document.getElementById('radiusValue').textContent = searchRadius === 0 ? 'æ— é™åˆ¶' : searchRadius.toFixed(0);
            interpolate();
        });
        
        document.getElementById('resolutionSlider').addEventListener('input', (e) => {
            resolution = parseInt(e.target.value);
            document.getElementById('resolutionValue').textContent = resolution;
            interpolate();
        });
        
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            let value;
            if (currentMode === 'normal') {
                value = Math.random() * 100;
            } else {
                value = 200 + Math.random() * 100;
            }
            
            points.push({x, y, value, isOutlier: currentMode === 'outlier'});
            updateStats();
            interpolate();
        });
        
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        function clearPoints() {
            points = [];
            updateStats();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        function generateUniform() {
            points = [];
            for (let i = 0; i < 20; i++) {
                points.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    value: Math.random() * 100,
                    isOutlier: false
                });
            }
            updateStats();
            interpolate();
        }
        
        function generateClustered() {
            points = [];
            const clusters = 3;
            for (let c = 0; c < clusters; c++) {
                const cx = Math.random() * canvas.width;
                const cy = Math.random() * canvas.height;
                const baseValue = Math.random() * 100;
                
                for (let i = 0; i < 8; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const dist = Math.random() * 80;
                    points.push({
                        x: cx + Math.cos(angle) * dist,
                        y: cy + Math.sin(angle) * dist,
                        value: baseValue + (Math.random() - 0.5) * 20,
                        isOutlier: false
                    });
                }
            }
            updateStats();
            interpolate();
        }
        
        function generateWithOutliers() {
            generateUniform();
            for (let i = 0; i < 5; i++) {
                points.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    value: 200 + Math.random() * 100,
                    isOutlier: true
                });
            }
            updateStats();
            interpolate();
        }
        
        function interpolate() {
            if (points.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            const data = imageData.data;
            
            let minVal = Infinity;
            let maxVal = -Infinity;
            
            for (let y = 0; y < canvas.height; y += resolution) {
                for (let x = 0; x < canvas.width; x += resolution) {
                    let sumWeights = 0;
                    let sumValues = 0;
                    
                    for (let point of points) {
                        const dx = x - point.x;
                        const dy = y - point.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 0.001) {
                            sumValues = point.value;
                            sumWeights = 1;
                            break;
                        }
                        
                        if (searchRadius > 0 && distance > searchRadius) continue;
                        
                        const weight = 1 / Math.pow(distance, power);
                        sumWeights += weight;
                        sumValues += weight * point.value;
                    }
                    
                    if (sumWeights > 0) {
                        const value = sumValues / sumWeights;
                        minVal = Math.min(minVal, value);
                        maxVal = Math.max(maxVal, value);
                        
                        const color = getColor(value, 0, maxVal);
                        
                        for (let dy = 0; dy < resolution; dy++) {
                            for (let dx = 0; dx < resolution; dx++) {
                                const px = x + dx;
                                const py = y + dy;
                                if (px < canvas.width && py < canvas.height) {
                                    const idx = (py * canvas.width + px) * 4;
                                    data[idx] = color.r;
                                    data[idx + 1] = color.g;
                                    data[idx + 2] = color.b;
                                    data[idx + 3] = 255;
                                }
                            }
                        }
                    }
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            for (let point of points) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 6, 0, Math.PI * 2);
                ctx.fillStyle = point.isOutlier ? '#ff0000' : '#000000';
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            updateLegend(minVal, maxVal);
        }
        
        function getColor(value, min, max) {
            const normalized = (value - min) / (max - min);
            const hue = (1 - normalized) * 240;
            return hslToRgb(hue / 360, 0.8, 0.5);
        }
        
        function hslToRgb(h, s, l) {
            let r, g, b;
            
            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            
            return {
                r: Math.round(r * 255),
                g: Math.round(g * 255),
                b: Math.round(b * 255)
            };
        }
        
        function updateLegend(min, max) {
            const gradient = document.getElementById('legendGradient');
            gradient.style.background = 'linear-gradient(to right, #4040ff, #40ffff, #40ff40, #ffff40, #ff4040)';
            
            document.getElementById('minLabel').textContent = min.toFixed(1);
            document.getElementById('midLabel').textContent = ((min + max) / 2).toFixed(1);
            document.getElementById('maxLabel').textContent = max.toFixed(1);
        }
        
        function updateStats() {
            const outliers = points.filter(p => p.isOutlier).length;
            const values = points.map(p => p.value);
            const min = values.length > 0 ? Math.min(...values) : 0;
            const max = values.length > 0 ? Math.max(...values) : 0;
            
            document.getElementById('pointCount').textContent = points.length;
            document.getElementById('outlierCount').textContent = outliers;
            document.getElementById('valueRange').textContent = 
                points.length > 0 ? `${min.toFixed(1)} - ${max.toFixed(1)}` : '-';
        }
        
        updateStats();
    </script>
</body>
</html>